!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@tensorflow/tfjs"),require("@tensorflow-models/toxicity")):"function"==typeof define&&define.amd?define(["@tensorflow/tfjs","@tensorflow-models/toxicity"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).sjs=t(e.tf,e.tfToxicity)}(this,(function(e,t){"use strict";function n(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=n(e),i=n(t);function r(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function c(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}l((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const s=2,c=(e,t,n="pre",o="pre",i=0)=>e.map((e=>{if(e.length>t&&("pre"===o?e.splice(0,e.length-t):e.splice(t,e.length-t)),e.length<t){const o=[];for(let n=0;n<t-e.length;++n)o.push(i);e="pre"===n?o.concat(e):e.concat(o)}return e})),l=e=>e.replace(/[^(a-zA-ZA-Яa-я0-9_)+\s]/g," ").split(/\s+/),u=e=>e>.65?"positive":e<.65?"negative":.65===e?"neutral":void 0;function f(e){return r(this,void 0,void 0,(function*(){const t=yield o.loadLayersModel("https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json"),n=yield fetch("https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json"),i=yield n.json(),r=l(e).map((e=>{let t=i.word_index[e]+i.index_from;return t>i.vocabulary_size&&(t=s),t})),f=c([r],i.max_len),a=o.tensor2d(f,[1,i.max_len]),d=t.predict(a),p=d.dataSync()[0];d.dispose();const y=u(Number(p.toFixed(2)));return{score:p,result:y}}))}function a(e){return r(this,void 0,void 0,(function*(){const t=yield i.load(.9,[]);return(yield t.classify(e)).map((e=>{if(!0===e.results[0].match)return{label:e.label,result:e.results[0].match}})).filter(Boolean)}))}const d={analyse:function(e){return r(this,arguments,void 0,(function*({text:e,type:t}){if("sentiment"===t){return{sentiment:yield f(e)}}if("toxicity"===t){return{toxicity:yield a(e)}}if("combined"===t){const t=yield f(e),n=yield a(e),o=yield function(e,t){return r(this,void 0,void 0,(function*(){if("negative"!==e.result){let e="positive";return t.forEach((t=>{!0===t.result&&(e="negative")})),e}return"negative"}))}(t,n);return{combined:o}}return{sentiment:yield f(e),toxicity:yield a(e)}}))}};return d}));
